{% extends 'solution/base.html' %}
{% load markup %}
{% load filters %}
{% block solution_content %}
    {% if solution.is_completed %}
        <div class="alert alert-info" xmlns="http://www.w3.org/1999/html">
            <b>This solution was completed</b> on {{ solution.time_completed|date }}{% if not is_owner %}, please review it{% endif %}.
        </div>
    {% elif solution.is_accepted %}
        <div class="alert alert-success" xmlns="http://www.w3.org/1999/html">
            <b>This solution was accepted</b> on {{ solution.time_accepted|date }}, you may begin work.
        </div>
    {% else %}
        <div class="alert alert-danger">
            <b>This solution has not been accepted yet</b>, if you wish you can start working on it on a personal branch.
        </div>
    {% endif %}
    <div class="row">
        <div class="span2">
            <h4><a href="#">{{ solution.user.first_name }}</a></h4>
            <p><img class="img-rounded" src="https://secure.gravatar.com/avatar/{{ solution.user.get_profile.gravatar_hash }}?s=100" /></p>
            <p><b>{{ solution.user.get_profile.impact }}</b> impact</p>
            <p><b>{{ solution.user.get_profile.completed }}</b> solutions</p>
        </div>
        <div class="span8">
            <h4>{{ solution.task.title }} <span class="muted">by {{ solution.user.first_name }}</span></h4>
            {% if solution.description %}
                {{ solution.description|markdown:"tables,fenced_code" }}
            {% else %}
                <p class="muted">Solution has not been described yet.</p>
            {% endif %}
            <form method="post">
                {% csrf_token %}
                <div class="btn-group">
                    {% if is_owner %}
                        {% if not solution.is_completed and solution.is_accepted %}
                            <button class="btn btn-info" type="submit" name="complete" value="1"><i class="icon-ok icon-white"></i></button>
                        {% endif %}
                        <a href="{% url 'project:solution:solution_edit' project.name solution.id %}" class="btn">edit</a>
                        {% if not solution.is_completed %}
                            <button class="btn" type="submit" name="delete" value="1"></i>delete</button>
                        {% endif %}
                    {% endif %}
                </div>
            </form>
            <hr/>
            {% if is_owner %}
                <p class="pull-right"><a class="btn btn-success" href="{% url 'project:task:new' project.name solution.id %}">create task</a></p>
            {% endif %}
            <h4>Tasks</h4>
            {% for task in solution.tasks.all %}
                <p><a href="{% url 'project:task:task' project.name task.id %}">{{ task.title }}</a></p>
            {% empty %}
                <p class="muted">No delegated tasks.</p>
            {% endfor %}
            <hr/>
        </div>
        <div class="span2 muted text-right">
            {{ solution.time_posted|timesince }} ago.
        </div>
    </div>
    {% if solution.is_accepted and is_owner %}
        <div class="alert alert-info">
            <p>Checkout solution branch :</p>
            <pre>git checkout -b s/{{ solution.id }} <i class="text-warning">[branch or sha to checkout]</i></pre>
            <p>Push to remote designated solution branch :</p>
            <pre>git push -u origin s/{{ solution.id }}</pre>
        </div>
    {% else %}
        <div class="alert alert-info">
            <p>Checkout solution branch :</p>
            <pre>git checkout -b s/{{ solution.id }} <i class="text-warning">[branch or sha to checkout]</i></pre>
            <p>Push to remote personal branch :</p>
            <pre>git push -u origin s/{{ solution.id }}:u/{{ user.username }}/s/{{ solution.id }}</pre>
        </div>
    {% endif %}
{% endblock %}