{% extends 'solution/base.html' %}
{% load markup %}
{% load filters %}
{% block solution_content %}
    <div class="row hidden-desktop hidden-tablet">
        <div class="span8">
            <img class="img-rounded pull-right" src="{{ solution.owner.gravatar }}?s=50" />
            <h4><a href="{% url 'user' solution.owner.username %}">{{ solution.owner.first_name }}</a></h4>
            <p><b>{{ solution.owner.impact }}</b> impact <b>{{ solution.owner.completed }}</b> solutions</p>
            <hr class="clearfix"/>
        </div>
    </div>
    <div class="row">
        <div class="span2 hidden-phone">
            <h4><a href="{% url 'user' solution.owner.username %}">{{ solution.owner.first_name }}</a></h4>
            <p><img class="img-rounded" src="{{ solution.owner.gravatar }}?s=100" /></p>
            <p><b>{{ solution.owner.impact }}</b> impact</p>
            <p><b>{{ solution.owner.completed }}</b> solutions</p>
        </div>
        <div class="span8">
            {% if solution.title %}
                <h4>{{ solution.title }}</h4>
            {% else %}
                <h4>{{ solution.task.title }} <span class="muted">by {{ solution.owner.first_name }}</span></h4>
            {% endif %}
            {% if solution.description %}
                {{ solution.description|markdown:"tables,fenced_code" }}
            {% else %}
                <p class="muted">Solution has not been described yet.</p>
            {% endif %}
            {% if user.is_authenticated %}
                <form method="post">
                    {% csrf_token %}
                    {% if solution.is_closed %}
                        <button class="btn" type="submit" name="reopen" value="1">reopen</button>
                    {% else %}
                        <div class="btn-group">
                            {% if not solution.is_completed %}
                                <a class="btn btn-success" href="{% url 'project:task:new' project.name solution.id %}">create task</a>
                            {% endif %}
                            {% if is_owner %}
                                <a href="{% url 'project:solution:solution_edit' project.name solution.id %}" class="btn">edit</a>
                                {% if not solution.is_completed %}
                                    <button class="btn" type="submit" name="close" value="1">close</button>
                                    <button class="btn btn-info" type="submit" name="complete" value="1"><i class="icon-ok icon-white"></i></button>
                                {% else %}
                                    <button class="btn" type="submit" name="incomplete" value="1">mark incomplete</button>
                                {% endif %}
                            {% else %}
                                {% if not solution.is_completed %}
                                    <a class="btn btn-success" href="{% url 'project:solution:new' project.name solution.id %}">suggest solution</a>
                                {% endif %}
                            {% endif %}
                        </div>
                    {% endif %}
                </form>
            {% endif %}
            {% if solution.is_completed %}
                <div class="alert alert-info">
                    <b>This solution was completed</b> on {{ solution.time_completed|date }}{% if not is_owner %}, please review it{% endif %}.
                </div>
            {% endif %}
            {% if solution.task %}
                <div class="alert alert-info">
                    <strong>Parent task :</strong> <a href="{% url 'project:task:task' project.name solution.task.id %}">{{ solution.task.title }}</a> by {{ solution.task.owner.first_name }}
                </div>
            {% elif solution.solution %}
                <div class="alert alert-info">
                    <strong>Parent solution :</strong> <a href="{% url 'project:solution:solution' project.name solution.solution.id %}">{{ solution.solution.default_title }}</a> by {{ solution.solution.owner.first_name }}
                </div>
            {% else %}
                <div class="alert alert-info">
                    This is a <strong>suggested solution</strong> without a parent ( task or solution ).
                </div>
            {% endif %}
            <span class="hidden-desktop hidden-tablet muted text-center">{{ solution.time_posted|timesince }} ago.</span>
            <hr/>
        </div>
        <div class="span2 muted text-right hidden-phone">
            {{ solution.time_posted|timesince }} ago.
        </div>
    </div>
    <div class="row">
        <div class="offset2 span8">
            <h5>Subtasks</h5>
        </div>
    </div>
    {% for task in subtasks %}
        <div class="row">
            {% with offset="offset2" %}
                {% include 'task/task_row_cells.html' %}
            {% endwith %}
        </div>
    {% empty %}
        <div class="row">
            <div class="offset2 span8">
                <p class="muted">No subtasks yet.</p>
            </div>
        </div>
    {% endfor %}
    <div class="row">
        <div class="offset2 span8">
            <h5>Suggested solutions</h5>
        </div>
    </div>
    <form method="post">
        {% csrf_token %}
        {% for suggested_solution in suggested_solutions %}
            <div class="row">
                {% with offset="offset2" solution=suggested_solution %}
                    {% include 'solution/solution_row_cells.html' %}
                {% endwith %}
            </div>
        {% empty %}
            <div class="row">
                <div class="offset2 span8">
                    <p class="muted">No suggested solutions yet.</p>
                </div>
            </div>
        {% endfor %}
    </form>
    <hr/>
    {% include "joltem/commenting.html" %}
    {% if is_owner %}
        <div class="alert alert-info">
            <p>Checkout this solution's branch :</p>
            <pre>git checkout -b s/{{ solution.id }} <i class="text-warning">[branch or sha to checkout]</i></pre>
            <p>Then push to this solutions designated remote solution branch :</p>
            <pre>git push -u origin s/{{ solution.id }}</pre>
        </div>
    {% else %}
        <div class="alert alert-info">
            <p>Checkout this solution's branch :</p>
            <pre>git fetch origin</pre>
            <pre>git checkout -b s/{{ solution.id }} origin/s/{{ solution.id }}</pre>
        </div>
    {% endif %}
{% endblock %}
