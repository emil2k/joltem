{% extends 'solution/base.html' %}
{% load markup %}
{% load filters %}
{% block solution_content %}
    {% if solution.is_completed %}
        <div class="alert alert-info" xmlns="http://www.w3.org/1999/html">
            <b>This solution was completed</b> on {{ solution.time_completed|date }}{% if not is_owner %}, please review it{% endif %}.
        </div>
    {% elif solution.is_accepted %}
        <div class="alert alert-success" xmlns="http://www.w3.org/1999/html">
            <b>This solution was accepted</b> on {{ solution.time_accepted|date }}, you may begin work.
        </div>
    {% else %}
        <div class="alert alert-danger">
            <b>This solution has not been accepted yet</b>, if you wish you can start working on it on a personal branch.
        </div>
    {% endif %}
    {% if solution.is_completed %}
        <form method="post">
            {% csrf_token %}
            <div class="row">
                <div class="span2 text-center">
                    {% if vote or is_owner %}
                        <small class="muted">{{ solution.vote_set.count }} votes</small>
                        {% if solution.impact > 0 %}
                            <h2 class="text-success">{{ solution.impact }}</h2>
                        {% elif solution.impact < 0 %}
                            {% load mathfilters %}
                            <h2 class="text-error">{{ solution.impact|abs }}</h2>
                        {% else %}
                            <h2 class="muted">0</h2>
                        {% endif %}
                        <p class="{% if solution.acceptance < 80 %}text-error{% else %}muted{% endif %}">
                            {{ solution.acceptance }}%<br/>
                            <small>acceptance</small><br/>
                        </p>
                    {% endif %}
                </div>
                <div class="span8">
                    <p>
                        <div class="btn-group">
                            <button class="btn {{ vote.is_rejected|css_class:"btn-danger" }}" type="submit" name="vote" value="reject"><i class="icon-remove {{ vote.is_rejected|css_class:"icon-white" }}"></i></button>
                            <button class="btn" type="submit" disabled><i>Impact</i></button>
                            <button class="btn {{ vote.vote|vote:0 }}" type="submit" name="vote" value="0"><b>0</b></button>
                            <button class="btn {{ vote.vote|vote:1 }}" type="submit" name="vote" value="1"><b>1</b></button>
                            <button class="btn {{ vote.vote|vote:2 }}" type="submit" name="vote" value="2"><b>2</b></button>
                            <button class="btn {{ vote.vote|vote:3 }}" type="submit" name="vote" value="3"><b>3</b></button>
                            <button class="btn {{ vote.vote|vote:4 }}" type="submit" name="vote" value="4"><b>4</b></button>
                            <button class="btn {{ vote.vote|vote:5 }}" type="submit" name="vote" value="5"><b>5</b></button>
                            <button class="btn {{ vote.vote|vote:6 }}" type="submit" name="vote" value="6"><b>6</b></button>
                            <button class="btn {{ vote.vote|vote:7 }}" type="submit" name="vote" value="7"><b>7</b></button>
                            <button class="btn {{ vote.vote|vote:8 }}" type="submit" name="vote" value="8"><b>8</b></button>
                            <button class="btn {{ vote.vote|vote:9 }}" type="submit" name="vote" value="9"><b>9</b></button>
                            <button class="btn {{ vote.vote|vote:10 }}" type="submit" name="vote" value="10"><b>10</b></button>
                        </div>
                    </p>
                    <textarea class="span8" rows=5 name="comment" placeholder="Comment about solution."></textarea><br/>
                </div>
            </div>
        </form>
    {% endif %}
    <hr/>
    <span class="muted pull-right">{{ solution.time_posted|timesince }} ago.</span>
    <h4><a href="#">{{ solution.user.first_name }}</a></h4>
    <div class="row">
        <div class="span2">
            <p><img class="img-rounded" src="https://secure.gravatar.com/avatar/{{ solution.user.get_profile.gravatar_hash }}?s=100" /></p>
            <p><b>{{ solution.user.get_profile.impact }}</b> impact</p>
            <p><b>{{ solution.user.get_profile.completed }}</b> solutions</p>
        </div>
        <div class="span8">
            {% if solution.description %}
                {{ solution.description|markdown:"tables,fenced_code" }}
            {% else %}
                <p class="muted">Solution has not been described yet.</p>
            {% endif %}
            <form method="post">
                {% csrf_token %}
                <div class="btn-group">
                    {% if is_owner %}
                        {% if not solution.is_completed and solution.is_accepted %}
                            <button class="btn btn-info" type="submit" name="complete" value="1"><i class="icon-ok icon-white"></i></button>
                        {% endif %}
                        <a href="{% url 'project:solution:solution_edit' project.name solution.id %}" class="btn">edit</a>
                        {% if not solution.is_completed %}
                            <button class="btn" type="submit" name="delete" value="1"></i>delete</button>
                        {% endif %}
                    {% endif %}
                </div>
            </form>
            <hr/>
            {% if is_owner %}
                <p class="pull-right"><a class="btn btn-success" href="{% url 'project:task:new_task' project.name solution.id %}">create task</a></p>
            {% endif %}
            <h4>Tasks</h4>
            {% include 'solution/solution_tasks.html' %}
            <hr/>
        </div>
    </div>
    {% if solution.is_accepted and is_owner %}
        <div class="alert alert-info">
            <p>Checkout solution branch :</p>
            <pre>git checkout -b s/{{ solution.id }} <i class="text-warning">[branch or sha to checkout]</i></pre>
            <p>Push to remote designated solution branch :</p>
            <pre>git push -u origin s/{{ solution.id }}</pre>
        </div>
    {% else %}
        <div class="alert alert-info">
            <p>Checkout solution branch :</p>
            <pre>git checkout -b s/{{ solution.id }} <i class="text-warning">[branch or sha to checkout]</i></pre>
            <p>Push to remote personal branch :</p>
            <pre>git push -u origin s/{{ solution.id }}:u/{{ user.username }}/s/{{ solution.id }}</pre>
        </div>
    {% endif %}
{% endblock %}